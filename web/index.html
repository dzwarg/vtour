<html>
<head>
  <title>vTour</title>

  <!-- ExtJS scripts -->
	<link rel="stylesheet" type="text/css" href="ext-2.0/resources/css/ext-all.css" />
 	<link rel="stylesheet" type="text/css" href="ext-2.0/resources/css/xtheme-gray.css" />
 	<script type="text/javascript" src="ext-2.0/adapter/ext/ext-base.js"></script>
  <script type="text/javascript" src="ext-2.0/ext-all.js"></script>
	<script type="text/javascript">
    Ext.onReady(function(){

      Ext.state.Manager.setProvider(new Ext.state.CookieProvider());
        
      // setup the viewport
      var viewport = new Ext.Viewport({
        layout:'border',
        items:[{
          region:'center',
          deferredRender:false,
          contentEl:'center',
          margins:'0 0 0 0'
        },{
          region:'east',
          layout:'accordion',
          width:200,
          defaults: {
            // applied to each contained panel
            bodyStyle:'margin:0px'
          },
          items:[
            { title:'Map Layers',
            contentEl:'mapLayerSwitcherPanel' },
            { title:'Search Distance',
            contentEl:'searchControl' }
          ]
        },{
          region:'south',
          title:'Search Results',
          collapsible:false,
          split:false,
          height:150,
          margins:'0 0 0 0',
          items:[
            new Ext.TabPanel({
              activeTab:0,
              items:[{
                contentEl:'south',
                title:'Search 1',
                autoScroll:true
              }]
            })
          ]
        }]
      });

      viewport.on( {
        'resize': function( obj, adjWidth, adjHeight, rawWidth, rawHeight ){ 
          if ( ol_resize ) {
            ol_resize();
          }
        }
      });

    });
	</script>
  <style type="text/css">
    div#mapLayerSwitcherPanel {
      padding:3px;
    }
    div#searchControl {
      padding:3px;
    }
  </style>
<!-- end ExtJS scripts -->

<!-- OpenLayers scripts -->
  <script type="text/javascript" src="OpenLayers/OpenLayers.js"></script>
<!--
  <script type="text/javascript" src="http://api.maps.yahoo.com/ajaxymap?v=3.7&appid=APP-ID"></script>
  <script type="text/javascript" src="http://maps.google.com/maps?file=api&v=2.82&key=GMAP-KEY"></script>
-->
  <script type="text/javascript">
    var ol_map,ol_layers,boxWidth=20;

    function ol_init(){
      var options = {
        projection: 'EPSG:900913',
        displayProjection: 'EPSG:4326',
        units: 'm',
        maxResolution: 156543.0339,
        maxExtent: new OpenLayers.Bounds(-20037508, -20037508,
                                          20037508, 20037508.34)
      };

      ol_map = new OpenLayers.Map('mapDiv', options);

      ol_map.addControl(new OpenLayers.Control.KeyboardDefaults());
      ol_map.addControl(new OpenLayers.Control.MousePosition());

      ol_layers = {
//        google: new OpenLayers.Layer.Google( 'Google', { type:G_NORMAL_MAP } ),
//        yahoo: new OpenLayers.Layer.Yahoo( 'Yahoo' ),
        osm: new OpenLayers.Layer.TMS( 'OpenStreetMap', 'http://tile.openstreetmap.org/',
          { type: 'png', getURL: osm_getTileURL,
            displayOutsideMaxExtent: true,
            attribution: '<a href="http://www.openstreetmap.org/">OpenStreetMap</a>' }),
        ol: new OpenLayers.Layer.WMS( 'OpenLayers WMS', 
            'http://labs.metacarta.com/wms/vmap0',
            {layers: 'basic'}, {'displayInLayerSwitcher':true} ),
        features: new OpenLayers.Layer.Vector('Bounding Boxes'),
        markers: new OpenLayers.Layer.Markers('Markers')
      };

      for ( var key in ol_layers )
      {
        ol_map.addLayer( ol_layers[key] );
      }

      ol_map.setCenter(new OpenLayers.LonLat(-75.16337,39.95234), 12);

      ol_map.events.register('click', ol_map, focusRegion );
    }

    function osm_getTileURL(bounds) {
      var res = this.map.getResolution();
      var x = Math.round((bounds.left - this.maxExtent.left) / (res * this.tileSize.w));
      var y = Math.round((this.maxExtent.top - bounds.top) / (res * this.tileSize.h));
      var z = this.map.getZoom();
      var limit = Math.pow(2, z);

      if (y < 0 || y >= limit) {
        return OpenLayers.Util.getImagesLocation() + "404.png";
      } else {
        x = ((x % limit) + limit) % limit;
        return this.url + z + "/" + x + "/" + y + "." + this.type;
      }
    }

    function ol_resize() {
      ol_map.updateSize();
    }

    function changeLayer( element ) {
      ol_map.setBaseLayer( ol_layers[ element.value ] );
    }

    function changeRadius( element ) {
      boxWidth = element.value * 2;
    }

    function focusRegion(e) {
      var lonlat = ol_map.getLonLatFromPixel(e.xy);
      var bounds = ol_map.getExtent();

      var sz = Math.min( bounds.getWidth(), bounds.getHeight() ) / boxWidth;

      var pointList = [];
      pointList.push( new OpenLayers.Geometry.Point( lonlat.lon - sz, lonlat.lat - sz ) );
      pointList.push( new OpenLayers.Geometry.Point( lonlat.lon - sz, lonlat.lat + sz ) );
      pointList.push( new OpenLayers.Geometry.Point( lonlat.lon + sz, lonlat.lat + sz ) );
      pointList.push( new OpenLayers.Geometry.Point( lonlat.lon + sz, lonlat.lat - sz ) );
      pointList.push( pointList[0] );

      var linearRing = new OpenLayers.Geometry.LinearRing( pointList );
      var polygonFeature = new OpenLayers.Feature.Vector(
                new OpenLayers.Geometry.Polygon([linearRing]));

      ol_layers['features'].addFeatures([polygonFeature]);
    }

    window.onload = ol_init;
  </script>
  <style type="text/css">
    div#mapDiv {
      height:100%;
      width:100%;
    }
  </style>
<!-- end OpenLayers scripts -->
</head>
<body>
  <div id="center">
    <div id="mapDiv">
    </div>
  </div>
  <div id="mapLayerSwitcherPanel">
    <ul>
      <!-- <li><input type="radio" name="olLayerName" value="google" onclick="changeLayer(this);"/>Google</li> -->
      <!-- <li><input type="radio" name="olLayerName" value="yahoo" onclick="changeLayer(this);"/>Yahoo</li> -->
      <li><input type="radio" name="olLayerName" value="osm" onclick="changeLayer(this);" checked="checked"/>OpenStreetMap</li>
      <li><input type="radio" name="olLayerName" value="ol" onclick="changeLayer(this);"/>OpenLayers</li>
    </ul>
  </div>
  <div id="searchControl">
    <ul>
      <li><input type="radio" name="searchRadius" value="20" onclick="changeRadius(this);" /> Small</li>
      <li><input type="radio" name="searchRadius" value="10" checked="checked" onclick="changeRadius(this);" /> Medium</li>
      <li><input type="radio" name="searchRadius" value="5" onclick="changeRadius(this);" /> Large</li>
    </ul>
  </div>
  <div id="south">
    <p>This is south content.</p>
  </div>
 </body>
</html>
